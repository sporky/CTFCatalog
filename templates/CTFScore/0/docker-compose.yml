version: '2'
services:
  CTFScore:
    image: sporky/scoreboard
    depends_on:
      ctfmysql:
        condition: service_healthy
    hostname: ctfscore
    stdin_open: true
    tty: true
    ports:
    - 80:8888/tcp
    labels:
      io.rancher.container.pull_image: always
      io.rancher.scheduler.affinity:host_label: service=board
      io.rancher.sidekicks: ctfmysql,ctfmemcache
    command:
      - /RootTheBox/setup/container_setup.sh
  ctfmysql:
    image: mysql/mysql-server
    hostname: rtbmysql
    environment:
      MYSQL_ROOT_PASSWORD: ctfadminverylongpassword
      MYSQL_USER: ctfadmin
      MYSQL_PASSWORD: ctfadminverylongpassword
      MYSQL_DATABASE: rootthebox
    stdin_open: true
    tty: true
    ports:
    - 6603:3306/tcp
    labels:
      io.rancher.container.pull_image: always
  ctfmemcache:
    image: memcached
    stdin_open: true
    tty: true
    ports:
    - 11011:11011/tcp
    labels:
      io.rancher.container.pull_image: always
  CTFBuild:
    image: sporky/ctfbuild
    stdin_open: true
    tty: true
    labels:
      io.rancher.scheduler.affinity:host_label: service=board
      io.rancher.container.start_once: 'true'
      io.rancher.container.requested_ip: 10.42.1.1
      